<svg viewBox="0 0 900 500" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
      <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#e5e5e5" stroke-width="0.5"/>
    </pattern>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <path d="M0,0 L0,6 L9,3 z" fill="#666"/>
    </marker>
    <marker id="arrow-blue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <path d="M0,0 L0,6 L9,3 z" fill="#3498db"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="900" height="500" fill="#fafafa"/>
  <rect width="900" height="500" fill="url(#grid)"/>

  <!-- Title -->
  <text x="40" y="35" font-family="monospace" font-size="14" fill="#333" font-weight="bold">Smart Session Memory System</text>
  <text x="295" y="35" font-family="monospace" font-size="12" fill="#888">[ TWO_LAYER_ARCHITECTURE ]</text>

  <!-- SCHEDULED LAYER -->
  <rect x="30" y="60" width="840" height="150" fill="none" stroke="#27ae60" stroke-width="2" rx="4"/>
  <text x="45" y="80" font-family="monospace" font-size="11" fill="#27ae60" font-weight="bold">SCHEDULED LAYER (Background)</text>

  <!-- launchd/cron -->
  <rect x="60" y="105" width="110" height="50" fill="#f0f0f0" stroke="#ccc" stroke-width="1.5" rx="3"/>
  <text x="115" y="127" font-family="monospace" font-size="9" fill="#666" text-anchor="middle">launchd</text>
  <text x="115" y="142" font-family="monospace" font-size="9" fill="#999" text-anchor="middle">(every 30 min)</text>

  <!-- Arrow 1 -->
  <line x1="170" y1="130" x2="205" y2="130" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- scheduled-session-sync.sh -->
  <rect x="215" y="105" width="150" height="50" fill="#e8f5e9" stroke="#27ae60" stroke-width="1.5" rx="3"/>
  <text x="290" y="135" font-family="monospace" font-size="9" fill="#27ae60" text-anchor="middle">scheduled-session-sync.sh</text>

  <!-- Arrow 2 -->
  <line x1="365" y1="130" x2="400" y2="130" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- sync-sessions-to-qmd.sh -->
  <rect x="410" y="105" width="150" height="50" fill="#e8f5e9" stroke="#27ae60" stroke-width="1.5" rx="3"/>
  <text x="485" y="135" font-family="monospace" font-size="9" fill="#27ae60" text-anchor="middle">sync-sessions-to-qmd.sh</text>

  <!-- Arrow 3 -->
  <line x1="560" y1="130" x2="595" y2="130" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- qmd embed -->
  <rect x="605" y="105" width="90" height="50" fill="#e8f5e9" stroke="#27ae60" stroke-width="1.5" rx="3"/>
  <text x="650" y="135" font-family="monospace" font-size="9" fill="#27ae60" text-anchor="middle">qmd embed</text>

  <!-- Arrow 4 -->
  <line x1="695" y1="130" x2="730" y2="130" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- QMD Index (shared) -->
  <rect x="740" y="175" width="110" height="100" fill="#fff3e0" stroke="#f39c12" stroke-width="2" rx="4"/>
  <text x="795" y="215" font-family="monospace" font-size="10" fill="#f39c12" text-anchor="middle" font-weight="bold">QMD INDEX</text>
  <text x="795" y="232" font-family="monospace" font-size="8" fill="#999" text-anchor="middle">claude-sessions</text>
  <text x="795" y="248" font-family="monospace" font-size="8" fill="#999" text-anchor="middle">collection</text>
  <text x="795" y="264" font-family="monospace" font-size="8" fill="#666" text-anchor="middle">229 sessions</text>

  <!-- Connection from qmd embed to index -->
  <path d="M 740 155 Q 795 155 795 175" fill="none" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- REACTIVE LAYER -->
  <rect x="30" y="230" width="700" height="230" fill="none" stroke="#3498db" stroke-width="2" rx="4"/>
  <text x="45" y="250" font-family="monospace" font-size="11" fill="#3498db" font-weight="bold">REACTIVE LAYER (Real-time)</text>

  <!-- UserPromptSubmit -->
  <rect x="60" y="275" width="130" height="40" fill="#e3f2fd" stroke="#3498db" stroke-width="1.5" rx="3"/>
  <text x="125" y="300" font-family="monospace" font-size="9" fill="#3498db" text-anchor="middle">UserPromptSubmit</text>

  <!-- Arrow to fork_suggest -->
  <line x1="190" y1="295" x2="240" y2="295" stroke="#3498db" stroke-width="1.5" marker-end="url(#arrow-blue)"/>

  <!-- fork_suggest_hook.sh -->
  <rect x="250" y="275" width="140" height="40" fill="#e3f2fd" stroke="#3498db" stroke-width="1.5" rx="3"/>
  <text x="320" y="300" font-family="monospace" font-size="9" fill="#3498db" text-anchor="middle">fork_suggest_hook.sh</text>

  <!-- PreToolUse -->
  <rect x="60" y="355" width="130" height="40" fill="#e3f2fd" stroke="#3498db" stroke-width="1.5" rx="3"/>
  <text x="125" y="380" font-family="monospace" font-size="9" fill="#3498db" text-anchor="middle">PreToolUse</text>

  <!-- Arrow to memory_injection -->
  <line x1="190" y1="375" x2="240" y2="375" stroke="#3498db" stroke-width="1.5" marker-end="url(#arrow-blue)"/>

  <!-- memory_injection.py -->
  <rect x="250" y="355" width="140" height="40" fill="#e3f2fd" stroke="#3498db" stroke-width="1.5" rx="3"/>
  <text x="320" y="380" font-family="monospace" font-size="9" fill="#3498db" text-anchor="middle">memory_injection.py</text>

  <!-- Tool matchers -->
  <text x="125" y="410" font-family="monospace" font-size="7" fill="#999" text-anchor="middle">Read|Edit|Write|Glob|Grep</text>

  <!-- Query arrows to index -->
  <path d="M 390 295 L 550 295 Q 600 295 650 265 L 740 225" fill="none" stroke="#3498db" stroke-width="1.5" stroke-dasharray="4,2" marker-end="url(#arrow-blue)"/>
  <path d="M 390 375 L 550 375 Q 600 375 650 305 L 740 255" fill="none" stroke="#3498db" stroke-width="1.5" stroke-dasharray="4,2" marker-end="url(#arrow-blue)"/>

  <!-- Query labels -->
  <text x="520" y="285" font-family="monospace" font-size="8" fill="#3498db">qmd search</text>
  <text x="520" y="390" font-family="monospace" font-size="8" fill="#3498db">qmd search</text>

  <!-- Output boxes -->
  <rect x="430" y="275" width="130" height="40" fill="#e8f5e9" stroke="#27ae60" stroke-width="1" rx="3"/>
  <text x="495" y="292" font-family="monospace" font-size="8" fill="#27ae60" text-anchor="middle">additionalContext</text>
  <text x="495" y="305" font-family="monospace" font-size="7" fill="#666" text-anchor="middle">"fork this session..."</text>

  <rect x="430" y="355" width="130" height="40" fill="#e8f5e9" stroke="#27ae60" stroke-width="1" rx="3"/>
  <text x="495" y="372" font-family="monospace" font-size="8" fill="#27ae60" text-anchor="middle">additionalContext</text>
  <text x="495" y="385" font-family="monospace" font-size="7" fill="#666" text-anchor="middle">"relevant past sessions..."</text>

  <!-- Output arrows -->
  <line x1="390" y1="290" x2="425" y2="290" stroke="#27ae60" stroke-width="1" marker-end="url(#arrow)"/>
  <line x1="390" y1="370" x2="425" y2="370" stroke="#27ae60" stroke-width="1" marker-end="url(#arrow)"/>

  <!-- Thinking extraction note -->
  <rect x="250" y="405" width="140" height="30" fill="none" stroke="#9b59b6" stroke-width="1" stroke-dasharray="3,2" rx="2"/>
  <text x="320" y="424" font-family="monospace" font-size="7" fill="#9b59b6" text-anchor="middle">extracts thinking block</text>

  <!-- Bottom note -->
  <text x="450" y="480" font-family="monospace" font-size="9" fill="#999" text-anchor="middle">Scheduled layer indexes sessions in background; Reactive layer queries and injects context in real-time</text>
</svg>